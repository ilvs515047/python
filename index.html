<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Win Python 98 Second Edition</title>
    <style>
        /* --- Win98 經典色盤與設定 --- */
        :root {
            --win-bg: #008080;
            --win-gray: #c0c0c0;
            --win-gray-dark: #808080;
            --win-gray-darker: #404040;
            --win-light: #ffffff;
            --win-title-blue-1: #000080;
            --win-title-blue-2: #1084d0;
            --win-text: #000000;
            --win-link-blue: #0000FF;
        }
        
        * { box-sizing: border-box; }

        /* 復古捲軸 */
        ::-webkit-scrollbar { width: 16px; height: 16px; background: var(--win-gray); }
        ::-webkit-scrollbar-thumb { background: var(--win-gray); border: 2px outset var(--win-light); }
        ::-webkit-scrollbar-button { background: var(--win-gray); border: 2px outset var(--win-light); width: 16px; height: 16px; }
        ::-webkit-scrollbar-button:vertical:decrement::after { content: "▴"; display: block; text-align: center; margin-top: -2px; color: black; }
        ::-webkit-scrollbar-button:vertical:increment::after { content: "▾"; display: block; text-align: center; margin-top: -2px; color: black; }
        
        body {
            background-color: var(--win-bg);
            font-family: "MS Sans Serif", "Microsoft Sans Serif", "Tahoma", monospace; 
            font-size: 12px;
            margin: 0; height: 100vh; display: flex; padding: 4px; overflow: hidden;
            cursor: default;
        }

        .window {
            width: 100%; height: 100%; background: var(--win-gray);
            border: 2px outset var(--win-light);
            display: flex; flex-direction: column;
            box-shadow: 1px 1px 2px black;
        }

        .title-bar {
            background: linear-gradient(90deg, var(--win-title-blue-1), var(--win-title-blue-2));
            padding: 3px 4px; color: white; font-weight: bold;
            display: flex; justify-content: space-between; align-items: center;
        }

        .win-control-btn {
            width: 16px; height: 14px; background: var(--win-gray);
            border: 2px outset var(--win-light);
            color: black; font-size: 9px; line-height: 10px; text-align: center; font-family: "Arial";
            margin-left: 2px;
        }

        .toolbar { padding: 4px; border-top: 1px solid var(--win-light); display: flex; gap: 6px; align-items: center; background: var(--win-gray); }
        .address-bar { flex: 1; border: 2px inset var(--win-light); background: white; padding: 2px 4px; font-family: monospace; }

        /* --- 改版：品牌Header區域 (移除廣告，使用圖片Logo) --- */
        .branding-section {
            display: flex; align-items: center; 
            justify-content: flex-start; /* 改為靠左對齊 */
            padding: 8px 12px; /* 縮小內距 */
            background: var(--win-gray);
            border-bottom: 1px solid var(--win-gray-dark);
            gap: 15px; /* Logo 與文字的間距 */
        }

        /* 新的圖片 Logo 樣式 */
        .win98-real-logo {
            height: 60px; /* 設定合適的高度，讓它看起來精緻 */
            width: auto;
            display: block;
        }

        /* Win Python 文字樣式調整 */
        .brand-title-new {
            font-family: "Arial Black", "Impact", sans-serif; 
            font-size: 28px; /* 稍微縮小一點 */
            font-style: italic; font-weight: 900;
            color: black; text-shadow: 1px 1px 0 white;
            letter-spacing: -1px; line-height: 1;
            margin-top: 10px; /* 微調垂直位置 */
        }

        /* (已移除所有廣告相關的 CSS) */

        /* --- 主體佈局 (維持不變) --- */
        .main-body { flex: 1; display: flex; padding: 6px; gap: 6px; overflow: hidden; border-top: 1px solid var(--win-light); border-left: 1px solid var(--win-light); border-right: 1px solid var(--win-gray-dark); border-bottom: 1px solid var(--win-gray-dark);}

        .sidebar {
            width: 210px; background: white; border: 2px inset var(--win-light);
            overflow-y: auto; padding: 4px; flex-shrink: 0;
        }
        .win-folder {
            width: 14px; height: 10px; background: #ffcc00; border: 1px solid #886600;
            position: relative; margin-right: 6px; border-radius: 1px;
        }
        .win-folder::before {
            content:''; position:absolute; top:-3px; left:0; width:7px; height:3px;
            background:inherit; border-top:1px solid #886600; border-left:1px solid #886600; border-right:1px solid #886600; border-radius: 2px 2px 0 0;
        }
        .nav-item { padding: 4px 2px; cursor: pointer; display: flex; align-items: center; color: black; }
        .nav-item:hover span { color: var(--win-link-blue); text-decoration: underline; }
        .nav-item.active { background: var(--win-title-blue-1); color: white; }
        .nav-item.active:hover span { color: white; text-decoration: none; }
        .nav-item.active .win-folder { border-color: white; }
        .done-mark { margin-left: auto; font-weight: bold; color: #008000; visibility: hidden; }
        .nav-item.completed .done-mark { visibility: visible; }

        .content-area { flex: 1; display: flex; gap: 6px; }
        .lesson-view { flex: 1; background: white; border: 2px inset var(--win-light); padding: 15px; overflow-y: auto; }
        .compiler-view { width: 48%; background: var(--win-gray); border: 2px inset var(--win-light); display: flex; flex-direction: column; }

        button.classic {
            background: var(--win-gray); border: 2px outset var(--win-light);
            padding: 3px 10px; color: black; font-family: inherit; font-size: 11px; cursor: pointer;
        }
        button.classic:active { border-style: inset; padding: 4px 9px 2px 11px; }
        button.classic:disabled { color: var(--win-gray-dark); text-shadow: 1px 1px 0 var(--win-light); }

        h2 { margin-top: 0; border-bottom: 1px solid var(--win-gray-dark); color: black; font-size: 16px; }
        h3 { font-size: 14px; color: #000080; margin-bottom: 5px; }
        
        .desc-box { background: #ffffe1; border: 1px solid black; padding: 10px; margin-bottom: 15px; box-shadow: 2px 2px 0 rgba(0,0,0,0.1); line-height: 1.5; }
        .quiz-card { border: 1px solid var(--win-gray-darker); background: var(--win-gray); padding: 8px; margin-bottom: 8px; box-shadow: 1px 1px 0 white inset; }
        .quiz-loading { padding: 10px; color: var(--win-gray-dark); font-style: italic; }

        pre { background: #000; color: #0f0; padding: 5px; border: 1px inset; font-family: monospace; white-space: pre-wrap; }
        code { background: #eee; padding: 0 4px; border: 1px solid #ccc; font-family: monospace; }

        .status-bar {
            border-top: 1px solid var(--win-light); border-bottom: 1px solid var(--win-gray-dark);
            padding: 2px 4px; font-size: 11px; color: black; display: flex; justify-content: space-between;
            background: var(--win-gray);
        }
        .status-panel { border: 1px inset var(--win-light); padding: 1px 4px; flex: 1; }
        .status-gripper {
            width: 15px; margin-left: 4px; border: 1px inset var(--win-light);
            background-image: repeating-linear-gradient(-45deg, var(--win-gray), var(--win-gray) 2px, var(--win-light) 2px, var(--win-light) 3px, var(--win-gray-dark) 3px, var(--win-gray-dark) 4px);
        }

    </style>
</head>
<body>

<div class="window">
    <div class="title-bar">
        <span>Python Learning System 98 (Dynamic DB)</span>
        <div style="display:flex;">
            <div class="win-control-btn">_</div>
            <div class="win-control-btn">□</div>
            <div class="win-control-btn" style="font-weight:bold;">X</div>
        </div>
    </div>
    
    <div class="toolbar">
        <span>Address:</span>
        <input type="text" class="address-bar" id="gasUrlInput" value="https://script.google.com/macros/s/AKfycbwS3DBMgCzw322ZNspbcJ64a2dgbSqgfUH-RRvvaYFDshbIK_9cs4HlbFWmD1VsPC9pKw/exec">
        <button class="classic" onclick="fetchData()">    GO    </button>
        <div style="flex:1;"></div>
        <button class="classic" id="syncBtn" onclick="syncToCloud()" style="display:flex; align-items:center; gap:4px;">
            <img src="https://cdn-icons-png.flaticon.com/128/482/482459.png" width="14" style="filter: grayscale(100%);"> 
            Save
        </button>
    </div>

    <div class="branding-section">
        <img src="https://upload.wikimedia.org/wikipedia/commons/archive/c/c1/20170726054839%21Windows_98_logo.svg" 
             alt="Windows 98 Logo" 
             class="win98-real-logo">
        
        <div class="brand-title-new">Win Python</div>
    </div>

    <div class="main-body">
        <div class="sidebar" id="sidebar">
            <div style="padding:10px; color:#666;">Connecting to server to fetch folder list...</div>
        </div>
        
        <div class="content-area">
            <div class="lesson-view" id="contentPanel">
                <div style="text-align:center; padding-top:50px;">
                    <img src="https://cdn-icons-png.flaticon.com/128/808/808398.png" width="64" style="filter:grayscale(80%); margin-bottom:20px;"><br>
                    <b>Connecting to Cloud Database...</b><br>Please wait while we download the lesson plan.
                </div>
            </div>
            
            <div class="compiler-view">
                <div style="color:white; background:var(--win-title-blue-1); padding:2px 4px; font-weight:bold; font-family:monospace; font-size:11px; display:flex; align-items:center;">
                    <span style="margin-right:4px;">>_</span> MS-DOS Prompt - python.exe
                </div>
                <iframe src="https://trinket.io/embed/python3/3d8d7ce66b?outputOnly=false&runOption=run&runMode=console" 
                        width="100%" height="100%" frameborder="0" style="background:black;"></iframe>
            </div>
        </div>
    </div>
    
    <div class="status-bar">
        <div class="status-panel" id="statusMsg">Dialing...</div>
        <div class="status-panel" style="width:100px; text-align:right;">Local Intranet</div>
        <div class="status-gripper"></div>
    </div>
</div>

<script>
    // --- JS 功能維持不變 (v10.0 版邏輯) ---
    let roadmap = []; 
    let dbQuestions = []; 
    let currentChapterIndex = 0;

    function init() {
        fetchData(); 
    }

    function fetchData() {
        const gasUrl = document.getElementById('gasUrlInput').value;
        const status = document.getElementById('statusMsg');
        
        status.innerText = "Downloading data pack...";
        
        fetch(gasUrl)
        .then(response => response.json())
        .then(data => {
            console.log("Data Received:", data);
            
            if (data.lessons && data.lessons.length > 0) {
                roadmap = data.lessons;
            } else {
                alert("Warning: No lessons found in 'Lessons' sheet.");
            }

            if (data.questions) {
                dbQuestions = data.questions;
            }

            status.innerText = `Online. (${roadmap.length} units, ${dbQuestions.length} questions)`;
            
            renderSidebar();
            loadLocalProgress(); 
            
            if(roadmap.length > 0) {
                renderContent(0);
            } else {
                document.getElementById('contentPanel').innerHTML = "No content loaded. Please check your Google Sheet.";
            }
        })
        .catch(err => {
            console.error(err);
            status.innerText = "Connection Failed.";
            document.getElementById('contentPanel').innerHTML = `<div style='color:red; font-weight:bold;'>Error connecting to Google Sheet.<br>Check your URL and Sheet permissions.<br>Error: ${err}</div>`;
        });
    }

    function renderSidebar() {
        const sidebar = document.getElementById('sidebar');
        sidebar.innerHTML = '<div style="padding:2px 4px; font-weight:bold; border-bottom:1px solid var(--win-gray-dark); margin-bottom:4px;">My Computer</div>';
        
        roadmap.forEach((item, index) => {
            const div = document.createElement('div');
            div.className = 'nav-item';
            div.id = `nav-${item.id}`;
            div.innerHTML = `<div class="win-folder"></div> <span>${item.title}</span> <span class="done-mark">✔</span>`;
            div.onclick = () => renderContent(index);
            sidebar.appendChild(div);
        });
    }

    function renderContent(index) {
        currentChapterIndex = index;
        const item = roadmap[index];
        
        document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
        const activeNav = document.getElementById(`nav-${item.id}`);
        if(activeNav) activeNav.classList.add('active');
        
        const panel = document.getElementById('contentPanel');
        
        const chapterQuestions = dbQuestions.filter(q => q.chapterId === item.id);

        let quizHtml = '';
        if (chapterQuestions.length === 0) {
            quizHtml = '<div class="quiz-loading">No questions for this unit yet.</div>';
        } else {
            chapterQuestions.forEach((q, idx) => {
                let opts = '';
                q.options.forEach((opt, optIdx) => {
                    opts += `<label style="display:block; cursor:pointer; margin-bottom:2px;"><input type="radio" name="q-${idx}" value="${optIdx}"> ${opt}</label>`;
                });
                
                quizHtml += `
                    <div class="quiz-card">
                        <span style="font-family:monospace; font-weight:bold;">[${q.level}]</span> 
                        <strong>${q.q}</strong>
                        <div style="margin:5px 0; border:1px inset var(--win-light); padding:5px; background:white;">${opts}</div>
                        <button class="classic" onclick="checkAns(this, ${q.ans})">Submit Answer</button>
                        <span style="margin-left:10px; font-weight:bold; font-family:monospace;"></span>
                    </div>
                `;
            });
        }

        panel.innerHTML = `
            <h2>${item.title}</h2>
            
            <div class="desc-box">
                <img src="https://cdn-icons-png.flaticon.com/128/761/761757.png" width="16" style="vertical-align:middle; margin-right:5px; filter:grayscale(100%);">
                ${item.content}
            </div>
            
            <h3 style="border-bottom:1px solid var(--win-gray-dark); color:black; background:var(--win-gray); padding:2px;">Quiz Explorer</h3>
            <div style="background:var(--win-gray); border:1px inset var(--win-light); padding:5px; max-height: 400px; overflow-y:auto;">
                ${quizHtml}
            </div>

            <div style="margin-top:20px;">
                <fieldset style="border:1px solid var(--win-gray-dark); padding:5px;">
                    <legend>User Notes</legend>
                    <textarea id="note-${item.id}" oninput="saveLocal('${item.id}')" style="width:100%; height:50px; font-family:monospace; border:2px inset var(--win-light);"></textarea>
                    <div style="margin-top:5px;">
                        <input type="checkbox" id="check-${item.id}" onchange="saveLocal('${item.id}')" style="vertical-align:middle;">
                        <label for="check-${item.id}" style="vertical-align:middle; cursor:pointer;">Mark Unit as Completed</label>
                    </div>
                </fieldset>
            </div>
        `;
        
        restorePageData(item.id);
    }

    window.checkAns = function(btn, correctIdx) {
        const parent = btn.parentElement;
        const selected = parent.querySelector('input:checked');
        const span = parent.querySelector('span:last-child');
        
        if(!selected) {
            span.innerText = "Selection required."; span.style.color = "red"; return;
        }
        if(parseInt(selected.value) === correctIdx) {
            span.innerText = "Correct OK."; span.style.color = "blue";
        } else {
            span.innerText = "Incorrect."; span.style.color = "red";
        }
    }

    function saveLocal(id) {
        const checked = document.getElementById(`check-${id}`).checked;
        const note = document.getElementById(`note-${id}`).value;
        const nav = document.getElementById(`nav-${id}`);
        if(checked) {
            if(nav) nav.classList.add('completed');
        } else {
            if(nav) nav.classList.remove('completed');
        }
        const data = { checked, note };
        localStorage.setItem(`py_win98se_v10_${id}`, JSON.stringify(data));
    }

    function loadLocalProgress() {
        roadmap.forEach(item => {
            const stored = localStorage.getItem(`py_win98se_v10_${item.id}`);
            if(stored) {
                const d = JSON.parse(stored);
                if(d.checked) {
                    const nav = document.getElementById(`nav-${item.id}`);
                    if(nav) nav.classList.add('completed');
                }
            }
        });
    }

    function restorePageData(id) {
        const stored = localStorage.getItem(`py_win98se_v10_${id}`);
        if(stored) {
            const d = JSON.parse(stored);
            const chk = document.getElementById(`check-${id}`);
            const txt = document.getElementById(`note-${id}`);
            if(chk) chk.checked = d.checked;
            if(txt) txt.value = d.note;
        }
    }

    window.syncToCloud = function() {
        const url = document.getElementById('gasUrlInput').value;
        const btn = document.getElementById('syncBtn');
        const status = document.getElementById('statusMsg');
        
        btn.disabled = true;
        status.innerText = "Sending data to server...";

        const payload = roadmap.map(item => {
            const stored = localStorage.getItem(`py_win98se_v10_${item.id}`);
            const d = stored ? JSON.parse(stored) : { checked: false, note: "" };
            return { id: item.id, title: item.title, checked: d.checked, note: d.note };
        });

        fetch(url, {
            method: 'POST', mode: 'no-cors', headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(payload)
        }).then(() => {
            status.innerText = "Data transfer complete."; btn.disabled = false;
            alert("Information Saved Successfully.");
        }).catch(err => {
            status.innerText = "Error during transfer."; btn.disabled = false;
            alert("Critical Error: " + err);
        });
    }

    init();
</script>
</body>
</html>
